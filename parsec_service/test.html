<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>How to test Parsec - The Parsec Book</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="expanded "><a href="../overview.html"><strong aria-hidden="true">2.</strong> Overview</a></li><li class="expanded "><a href="../api_coverage.html"><strong aria-hidden="true">3.</strong> API coverage</a></li><li class="expanded "><a href="../parsec_users.html"><strong aria-hidden="true">4.</strong> Parsec for users</a></li><li class="expanded "><a href="../parsec_client/index.html"><strong aria-hidden="true">5.</strong> Parsec for client developers</a></li><li><ol class="section"><li class="expanded "><a href="../parsec_client/operations/index.html"><strong aria-hidden="true">5.1.</strong> Operations</a></li><li><ol class="section"><li class="expanded "><a href="../parsec_client/operations/add_client.html"><strong aria-hidden="true">5.1.1.</strong> AddClient</a></li><li class="expanded "><a href="../parsec_client/operations/list_opcodes.html"><strong aria-hidden="true">5.1.2.</strong> ListOpcodes</a></li><li class="expanded "><a href="../parsec_client/operations/list_providers.html"><strong aria-hidden="true">5.1.3.</strong> ListProviders</a></li><li class="expanded "><a href="../parsec_client/operations/ping.html"><strong aria-hidden="true">5.1.4.</strong> Ping</a></li><li class="expanded "><a href="../parsec_client/operations/prove_client.html"><strong aria-hidden="true">5.1.5.</strong> ProveClient</a></li><li class="expanded "><a href="../parsec_client/operations/psa_asymmetric_sign.html"><strong aria-hidden="true">5.1.6.</strong> PsaAsymmetricSign</a></li><li class="expanded "><a href="../parsec_client/operations/psa_asymmetric_verify.html"><strong aria-hidden="true">5.1.7.</strong> PsaAsymmetricVerify</a></li><li class="expanded "><a href="../parsec_client/operations/psa_create_key.html"><strong aria-hidden="true">5.1.8.</strong> PsaCreateKey</a></li><li class="expanded "><a href="../parsec_client/operations/psa_destroy_key.html"><strong aria-hidden="true">5.1.9.</strong> PsaDestroyKey</a></li><li class="expanded "><a href="../parsec_client/operations/psa_export_public_key.html"><strong aria-hidden="true">5.1.10.</strong> PsaExportPublicKey</a></li><li class="expanded "><a href="../parsec_client/operations/psa_import_key.html"><strong aria-hidden="true">5.1.11.</strong> PsaImportKey</a></li><li class="expanded "><a href="../parsec_client/operations/share_trust_bundle.html"><strong aria-hidden="true">5.1.12.</strong> ShareTrustBundle</a></li><li class="expanded "><a href="../parsec_client/operations/key_attributes.html"><strong aria-hidden="true">5.1.13.</strong> Key Attributes</a></li></ol></li><li class="expanded "><a href="../parsec_client/api_overview.html"><strong aria-hidden="true">5.2.</strong> API Overview</a></li><li class="expanded "><a href="../parsec_client/status_codes.html"><strong aria-hidden="true">5.3.</strong> Status Codes</a></li><li class="expanded "><a href="../parsec_client/wire_protocol.html"><strong aria-hidden="true">5.4.</strong> Wire Protocol</a></li><li class="expanded "><a href="../parsec_client/writing_library.html"><strong aria-hidden="true">5.5.</strong> Writing a new Parsec Client Library</a></li></ol></li><li class="expanded "><a href="../parsec_service/index.html"><strong aria-hidden="true">6.</strong> Parsec for service developers</a></li><li><ol class="section"><li class="expanded "><a href="../parsec_service/system_architecture.html"><strong aria-hidden="true">6.1.</strong> System Architecture</a></li><li class="expanded "><a href="../parsec_service/interfaces_and_dataflow.html"><strong aria-hidden="true">6.2.</strong> Interfaces and Dataflow</a></li><li class="expanded "><a href="../parsec_service/source_code_structure.html"><strong aria-hidden="true">6.3.</strong> Source Code Structure</a></li><li class="expanded "><a href="../parsec_service/providers.html"><strong aria-hidden="true">6.4.</strong> Providers</a></li><li class="expanded "><a href="../parsec_service/converters.html"><strong aria-hidden="true">6.5.</strong> Converters</a></li><li class="expanded "><a href="../parsec_service/authenticators.html"><strong aria-hidden="true">6.6.</strong> Authenticators</a></li><li class="expanded "><a href="../parsec_service/listeners.html"><strong aria-hidden="true">6.7.</strong> Listeners</a></li><li class="expanded "><a href="../parsec_service/key_id_managers.html"><strong aria-hidden="true">6.8.</strong> Key ID Managers</a></li><li class="expanded "><a href="../parsec_service/adding_provider.html"><strong aria-hidden="true">6.9.</strong> Adding a new Parsec Provider</a></li><li class="expanded "><a href="../parsec_service/build_run.html"><strong aria-hidden="true">6.10.</strong> How to build and run Parsec</a></li><li class="expanded "><a href="../parsec_service/install_parsec_linux.html"><strong aria-hidden="true">6.11.</strong> How to install Parsec on Linux</a></li><li class="expanded "><a href="../parsec_service/configuration.html"><strong aria-hidden="true">6.12.</strong> Parsec Configuration</a></li><li class="expanded "><a href="../parsec_service/test.html" class="active"><strong aria-hidden="true">6.13.</strong> How to test Parsec</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">The Parsec Book</h1>

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#how-to-test-parsec" id="how-to-test-parsec">How to test Parsec</a></h1>
<p>Parsec relies on a mix of unit, integration, stress and fuzz tests. Unit tests are usually found in
the same module as the code they verify. Integration tests can be found in the <code>tests</code> directory
(along with the code framework required for running them), and come in two flavours: single-provider
and all-providers.</p>
<p>Single-provider tests do a thorough verification of each individual provider, while all-providers
tests check that the common functionality is capable of supporting multiple providers at the same
time. Another subcategory of integration tests are persistance tests which check that key material
is persisted through service restarts.</p>
<p>The stress test simply constructs and sends random requests as fast as possible using a
multithreaded client. Valid requests are sent intermittently so as to check that the service is
still up and working correctly.</p>
<p>The <code>tests/ci.sh</code> script executes all tests and is used on the CI.
<a href="https://github.com/rust-lang/rustfmt"><code>rustfmt</code></a> and
<a href="https://github.com/rust-lang/rust-clippy"><code>clippy</code></a> are needed for code formatting and static
checks.</p>
<p>The <a href="https://github.com/parallaxsecond/parsec-client-test">test client</a> is used for integration
testing. Check that repository for more details.</p>
<h2><a class="header" href="#executing-tests-manually" id="executing-tests-manually">Executing tests manually</a></h2>
<h3><a class="header" href="#static-tests" id="static-tests">Static tests</a></h3>
<h4><a class="header" href="#checking-code-formatting" id="checking-code-formatting">Checking code formatting</a></h4>
<pre><code>cargo fmt --all -- --check
</code></pre>
<h4><a class="header" href="#checking-lints" id="checking-lints">Checking lints</a></h4>
<pre><code>cargo clippy --all-targets --all-features -- -D clippy::all -D clippy::cargo
</code></pre>
<h3><a class="header" href="#unit-tests" id="unit-tests">Unit tests</a></h3>
<h4><a class="header" href="#doc-tests" id="doc-tests">Doc tests</a></h4>
<pre><code>cargo test --doc --all-features
</code></pre>
<h4><a class="header" href="#unit-tests-1" id="unit-tests-1">Unit tests</a></h4>
<pre><code>cargo test --lib --all-features
</code></pre>
<h3><a class="header" href="#integration-tests" id="integration-tests">Integration tests</a></h3>
<h4><a class="header" href="#normal-integration-tests" id="normal-integration-tests">Normal integration tests</a></h4>
<pre><code>cargo test normal_tests
</code></pre>
<h4><a class="header" href="#persistence-integration-tests" id="persistence-integration-tests">Persistence integration tests</a></h4>
<p>Those check if the Key ID mapping persist after a shutdown (check the <code>tests/ci.sh</code> script for
details of commands to execute).</p>
<h4><a class="header" href="#stress-tests" id="stress-tests">Stress tests</a></h4>
<pre><code>cargo test stress_test
</code></pre>
<h4><a class="header" href="#all-providers-integration-tests" id="all-providers-integration-tests">All providers integration tests.</a></h4>
<p>This expect the Parsec service to include all providers.</p>
<pre><code>cargo test all_providers
</code></pre>
<h2><a class="header" href="#fuzz-testing" id="fuzz-testing">Fuzz testing</a></h2>
<p>Fuzz testing works, at the moment, on a service level, generating random requests and sending them
to be processed. Running the fuzz tests can be done through the <code>fuzz.sh</code> script in the root of the
repository. <code>./fuzz.sh run</code> builds a Docker image where the fuzz tests will run. It then sets up the
environment and initiates the test in the container. The fuzzing engine
(<a href="http://llvm.org/docs/LibFuzzer.html">libFuzzer</a>) works by generating random inputs for a fuzzing
target and then observing the code segments reached using said input. To stop the fuzzer, simply run
<code>./fuzz.sh stop</code>. To view the logs of a currently executing fuzzer, run <code>./fuzz.sh follow</code>. Any
crashes or slow tests, as well as tests that lead to a timeout, are stored in
<code>./fuzz/artifacts/fuzz_service/</code>.</p>
<p><em>Copyright (c) 2019, Arm Limited. All rights reserved.</em></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../parsec_service/configuration.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../parsec_service/configuration.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
